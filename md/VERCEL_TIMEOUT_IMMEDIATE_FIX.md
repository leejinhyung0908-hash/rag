# Vercel 타임아웃 즉시 해결 가이드

## 🚨 현재 상황

- ✅ EC2 서비스 정상 실행 중
- ✅ 포트 8000 리스닝 중
- ❌ Vercel에서 EC2로 연결 타임아웃

## 🔧 즉시 확인할 사항

### 1. AWS 보안 그룹 재확인 (가장 중요!)

**AWS 콘솔에서:**

1. **EC2 콘솔** → **인스턴스** → 인스턴스 선택
2. **보안** 탭 → **보안 그룹** 클릭
3. **인바운드 규칙** 확인:
   - 포트 `8000`이 있는지 확인
   - 소스가 `0.0.0.0/0`인지 확인
   - **규칙이 저장되었는지 확인** (Save rules 클릭했는지)

**규칙이 없거나 잘못되었으면:**

1. **인바운드 규칙 편집** 클릭
2. **규칙 추가** 클릭
3. 다음 설정:
   - **유형**: `사용자 지정 TCP`
   - **포트**: `8000`
   - **소스**: `0.0.0.0/0` (모든 IPv4 주소)
   - **설명**: `Vercel API access`
4. **규칙 저장** 클릭 (중요!)

### 2. EC2 실시간 로그 모니터링

EC2에서:
```bash
# 실시간 로그 확인
sudo journalctl -u rag-api.service -f
```

**그 다음:**
- Vercel 사이트에서 메시지를 보내면
- 로그에 요청이 나타나는지 확인
- 요청이 없으면 보안 그룹 문제

### 3. Vercel 환경 변수 확인

**Vercel 대시보드:**
1. Settings → Environment Variables
2. `BACKEND_URL` 확인: `http://13.125.210.86:8000`
3. 값이 올바른지 확인

### 4. Vercel Redeploy

보안 그룹 수정 후:
1. Vercel 대시보드 → Deployments
2. 최신 배포 → Redeploy 클릭

## 📊 로그 분석 결과

### 성공한 요청들

```
Dec 22 01:35:48 - 45.33.12.214 - "GET / HTTP/1.1" 200 OK
Dec 22 01:36:27 - 172.236.228.193 - "GET / HTTP/1.1" 200 OK
Dec 19 08:39:11 - 52.202.47.133 - "POST /api/v1/chat HTTP/1.1" 200 OK (Vercel)
```

**의미:**
- 다른 IP에서는 접속 성공
- 이전에는 Vercel에서도 성공했음
- 현재는 Vercel에서 타임아웃 발생

### 문제

- 최근 로그에 Vercel 요청이 없음
- Vercel 함수 로그에서 타임아웃 발생

## ✅ 빠른 해결 순서

1. **AWS 보안 그룹 확인 및 수정**
   - 포트 8000 규칙 확인
   - `0.0.0.0/0` 소스 확인
   - **규칙 저장** 클릭

2. **EC2 실시간 로그 확인**
   ```bash
   sudo journalctl -u rag-api.service -f
   ```

3. **Vercel 사이트에서 테스트**
   - 메시지 전송
   - EC2 로그에 요청이 나타나는지 확인

4. **Vercel Redeploy**
   - 보안 그룹 수정 후 Redeploy

## 🆘 여전히 문제가 있으면

1. **EC2 인스턴스 재시작**
   - AWS 콘솔에서 인스턴스 재시작
   - 퍼블릭 IP가 변경될 수 있으므로 확인 필요

2. **새 보안 그룹 생성**
   - 기존 보안 그룹 대신 새 보안 그룹 생성
   - 포트 8000 규칙 추가
   - 인스턴스에 새 보안 그룹 연결

3. **Elastic IP 할당**
   - EC2에 Elastic IP 할당
   - 고정 IP 사용으로 IP 변경 문제 해결
